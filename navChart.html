<script>
  document.addEventListener('DOMContentLoaded', function () {
    const csvUrl = 'https://raw.githubusercontent.com/mcleancapital/website/refs/heads/main/Diamond_Chart.csv';

    fetch(csvUrl)
      .then(response => response.text())
      .then(data => {
        const parsedData = parseCSV(data);

        Highcharts.stockChart('navChartContainer', {
          rangeSelector: { selected: 1 },
          title: { text: 'Fund NAV Historical Performance' },
          series: [{
            name: 'NAV',
            data: parsedData,
            tooltip: { valueDecimals: 2 }
          }],
          tooltip: { split: true },
          navigator: { enabled: true },
          scrollbar: { enabled: true }
        });
      })
      .catch(error => console.error('Error fetching data:', error));

    function parseCSV(data) {
      const rows = data.split('\n').slice(1); // Remove header row
      return rows.map(row => {
        const [dateStr, value] = row.split(',');
        if (dateStr && value) {
          // Split the date into components and convert to numbers
          const [year, month, day] = dateStr.trim().split('-').map(Number);

          // Create a UTC date
          const utcDate = Date.UTC(year, month - 1, day); // Month is zero-indexed

          const numericValue = parseFloat(value.trim());

          // Only add valid data points
          if (!isNaN(utcDate) && !isNaN(numericValue)) {
            return [utcDate, numericValue];
          }
        }
      }).filter(Boolean); // Filter out any undefined entries
    }
  });
</script>
