document.addEventListener('DOMContentLoaded', function () {
  const csvUrl = 'https://raw.githubusercontent.com/mcleancapital/website/main/Diamond_Chart.csv';

  fetch(csvUrl)
    .then(response => {
      if (!response.ok) throw new Error("Network response was not ok");
      return response.text();
    })
    .then(data => {
      console.log("CSV data:", data); // Log raw CSV data
      const parsedData = parseCSV(data);
      console.log("Parsed data:", parsedData); // Log parsed data to confirm

      Highcharts.stockChart('navChartContainer', {
        rangeSelector: { selected: 1 },
        title: { text: 'Fund NAV Historical Performance' },
        series: [{
          name: 'NAV',
          data: parsedData,
          tooltip: { valueDecimals: 2 }
        }],
        tooltip: { split: true },
        navigator: { enabled: true },
        scrollbar: { enabled: true }
      });
    })
    .catch(error => console.error('Error fetching data:', error));

  function parseCSV(data) {
    const rows = data.split('\n').slice(1); // Remove header row
    return rows.map(row => {
      const [dateStr, value] = row.split(',');
      const date = new Date(dateStr.trim());
      const numericValue = parseFloat(value.trim());

      if (!isNaN(numericValue)) {
        return [Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()), numericValue];
      } else {
        console.error("Invalid data row:", row); // Debug invalid rows
      }
    }).filter(Boolean);
  }
});
