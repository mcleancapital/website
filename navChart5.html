<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fund NAV Chart</title>
  <!-- Load Highcharts -->
  <script src="https://code.highcharts.com/stock/highstock.js"></script>

  <!-- Load data generated from __MCI2.xlsx -->
  <script src="mci2_nav_data.js"></script>
</head>
<body>
  <!-- Container for the chart -->
  <div id="navChartContainer" style="width: 100%; height: 400px;"></div>

  <!-- JavaScript to create the chart -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      if (typeof navData === 'undefined' || !navData.length) {
        console.error("navData is not loaded. Check mci2_nav_data.js.");
        return;
      }

      function getStartNav(startDate) {
        for (let i = 0; i < navData.length; i++) {
          if (navData[i][0] >= startDate) {
            return navData[i][1];
          }
        }
        return navData[0][1];
      }

      function updateChart(startDate) {
        const startNav = getStartNav(startDate);
        const updatedData = navData.map(point => ({
          x: point[0],
          y: point[1],
          change: ((point[1] - startNav) / startNav) * 100
        }));

        chart.series[0].setData(updatedData);
      }

      const chart = Highcharts.stockChart('navChartContainer', {
        rangeSelector: {
          buttons: [
            {
              type: 'month',
              count: 1,
              text: '1m',
              events: {
                click: () => updateChart(new Date().setMonth(new Date().getMonth() - 1))
              }
            },
            {
              type: 'month',
              count: 3,
              text: '3m',
              events: {
                click: () => updateChart(new Date().setMonth(new Date().getMonth() - 3))
              }
            },
            {
              type: 'month',
              count: 6,
              text: '6m',
              events: {
                click: () => updateChart(new Date().setMonth(new Date().getMonth() - 6))
              }
            },
            {
              type: 'year',
              count: 1,
              text: '1yr',
              events: {
                click: () => updateChart(new Date().setFullYear(new Date().getFullYear() - 1))
              }
            },
            {
              type: 'ytd',
              text: 'YTD',
              events: {
                click: () => updateChart(new Date(new Date().getFullYear(), 0, 1))
              }
            },
            {
              type: 'all',
              text: 'ALL',
              events: {
                click: () => updateChart(navData[0][0])
              }
            }
          ],
          selected: 1
        },
        title: { text: 'Fund NAV Historical Performance' },
        series: [{
          name: 'NAV',
          data: navData.map(point => ({ x: point[0], y: point[1], change: 0 })),
          tooltip: {
            pointFormatter: function() {
              return `<span style="color:${this.series.color}">‚óè</span> ` +
                     `NAV: <b>${this.y.toFixed(2)}</b><br/>` +
                     `Change: <b>${this.change.toFixed(2)}%</b>`;
            },
            valueDecimals: 2
          }
        }],
        xAxis: {
          events: {
            afterSetExtremes: function (e) {
              if (e.min) {
                updateChart(e.min);
              }
            }
          }
        }
      });

      // Initial: YTD
      updateChart(new Date(new Date().getFullYear(), 0, 1));
    });
  </script>
</body>
</html>
